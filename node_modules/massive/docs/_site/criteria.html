<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Massive.js by dmfay</title>

    <link rel="stylesheet" href="/massive-js/assets/css/style.css?v=8f3b5004dbc09941550749da6d7e90b279e958cc">
    <link rel="stylesheet" href="/assets/css/custom.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="/massive-js">Massive.js</a></h1>
        <p>Massive.js is a data mapper for Node.js that goes all in on PostgreSQL and fully embraces the power and flexibility of the SQL language and relational metaphors. Providing minimal abstractions for the interfaces and tools you already use, its goal is to do just enough to make working with your data as easy and intuitive as possible, then get out of your way.
</p>

        
          <p class="view"><a href="http://github.com/dmfay/massive-js">View the Project on GitHub <small></small></a></p>
        

        <h2>Contents</h2>
        <ul class="toc">
          <li><a href="/massive-js/connecting.html">Connecting</a></li>
          <li><a href="/massive-js/criteria.html">Criteria Objects</a></li>
          <li><a href="/massive-js/queries.html">Queries</a></li>
          <li><a href="/massive-js/persistence.html">Persistence</a></li>
          <li><a href="/massive-js/documents.html">Working with Documents</a></li>
          <li><a href="/massive-js/functions.html">Functions and Scripts</a></li>
          <li><a href="/massive-js/run.html">Raw SQL</a></li>
          <li><a href="/massive-js/api/index.html">API Docs</a></li>
        </ul>

        

        
        <p>This project is maintained by <a href="http://github.com/dmfay">dmfay</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>

        
      </header>
      <section>

      <h1 id="criteria-objects">Criteria Objects</h1>

<p>Many Massive functions use criteria objects to build <code class="highlighter-rouge">WHERE</code> clauses. Although they are principally used in query functions, there are other uses for them. In particular, bulk updates use criteria objects to filter data being modified.</p>

<p>A criteria object is a “plain old JavaScript object” where keys represent the fields to search and values are prepared statement parameters.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// this will search for all active records where the name</span>
<span class="c1">// contains 'homepage' and the JSON 'stats' field shows</span>
<span class="c1">// more than 5 runs</span>

<span class="kr">const</span> <span class="nx">criteria</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">is_active</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s1">'name like'</span><span class="p">:</span> <span class="s1">'%homepage%'</span><span class="p">,</span>
  <span class="s1">'stats -&gt;&gt; runs &gt;'</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">};</span>
</code></pre>
</div>

<h2 id="operations">Operations</h2>

<p>Keys in a criteria object may contain an operator which is converted to a SQL operator in the <code class="highlighter-rouge">WHERE</code> clause. If no operator is provided, the predicate will test for equality.</p>

<p>Text operators are case-insensitive.</p>

<h3 id="scalar-comparison">Scalar Comparison</h3>

<table>
  <thead>
    <tr>
      <th>Format</th>
      <th>SQL operator</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>nothing or <code class="highlighter-rouge">=</code></td>
      <td><code class="highlighter-rouge">=</code></td>
      <td>Equality</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">!</code>, <code class="highlighter-rouge">!=</code>, <code class="highlighter-rouge">&lt;&gt;</code></td>
      <td><code class="highlighter-rouge">&lt;&gt;</code></td>
      <td>Inequality</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">&lt;</code></td>
      <td><code class="highlighter-rouge">&lt;</code></td>
      <td>Less than</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">&lt;=</code></td>
      <td><code class="highlighter-rouge">&lt;=</code></td>
      <td>Less than or equal</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">&gt;</code></td>
      <td><code class="highlighter-rouge">&gt;</code></td>
      <td>Greater than</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">&gt;=</code></td>
      <td><code class="highlighter-rouge">&gt;=</code></td>
      <td>Greater than or equal</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">BETWEEN</code></td>
      <td><code class="highlighter-rouge">BETWEEN</code></td>
      <td>Test whether value is between a lower and upper bound</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">IS DISTINCT FROM</code></td>
      <td><code class="highlighter-rouge">IS DISTINCT FROM</code></td>
      <td>Difference test with <code class="highlighter-rouge">NULL</code> considered a fixed value</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">IS NOT DISTINCT FROM</code></td>
      <td><code class="highlighter-rouge">IS NOT DISTINCT FROM</code></td>
      <td>Equality test with <code class="highlighter-rouge">NULL</code> considered a fixed value</td>
    </tr>
  </tbody>
</table>

<h3 id="arrays">Arrays</h3>

<table>
  <thead>
    <tr>
      <th>Format</th>
      <th>SQL operator</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">@&gt;</code></td>
      <td><code class="highlighter-rouge">@&gt;</code></td>
      <td>Array contains</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">&lt;@</code></td>
      <td><code class="highlighter-rouge">&lt;@</code></td>
      <td>Array contained in</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">&amp;&amp;</code></td>
      <td><code class="highlighter-rouge">&amp;&amp;</code></td>
      <td>Array overlaps</td>
    </tr>
  </tbody>
</table>

<h3 id="pattern-matching">Pattern Matching</h3>

<table>
  <thead>
    <tr>
      <th>Format</th>
      <th>SQL operator</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">~~</code>, <code class="highlighter-rouge">LIKE</code></td>
      <td><code class="highlighter-rouge">LIKE</code></td>
      <td>Case-sensitive string equality with <code class="highlighter-rouge">%</code> and <code class="highlighter-rouge">_</code> wildcards</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">!~~</code>, <code class="highlighter-rouge">NOT LIKE</code></td>
      <td><code class="highlighter-rouge">NOT LIKE</code></td>
      <td>Case-sensitive string difference with <code class="highlighter-rouge">%</code> and <code class="highlighter-rouge">_</code> wildcards</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">~~*</code>, <code class="highlighter-rouge">ILIKE</code></td>
      <td><code class="highlighter-rouge">ILIKE</code></td>
      <td>Case-insensitive string equality with <code class="highlighter-rouge">%</code> and <code class="highlighter-rouge">_</code> wildcards</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">!~~*</code>, <code class="highlighter-rouge">NOT ILIKE</code></td>
      <td><code class="highlighter-rouge">NOT ILIKE</code></td>
      <td>Case-insensitive string difference with <code class="highlighter-rouge">%</code> and <code class="highlighter-rouge">_</code> wildcards</td>
    </tr>
  </tbody>
</table>

<h3 id="regular-expressions">Regular Expressions</h3>

<table>
  <thead>
    <tr>
      <th>Format</th>
      <th>SQL operator</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">SIMILAR TO</code></td>
      <td><code class="highlighter-rouge">SIMILAR TO</code></td>
      <td>SQL regular expression match</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">NOT SIMILAR TO</code></td>
      <td><code class="highlighter-rouge">NOT SIMILAR TO</code></td>
      <td>SQL regular expression mismatch</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">~</code></td>
      <td><code class="highlighter-rouge">~</code></td>
      <td>Case-sensitive POSIX regular expression match</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">!~</code></td>
      <td><code class="highlighter-rouge">!~</code></td>
      <td>Case-sensitive POSIX regular expression mismatch</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">~*</code></td>
      <td><code class="highlighter-rouge">~*</code></td>
      <td>Case-insensitive POSIX regular expression match</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">!~*</code></td>
      <td><code class="highlighter-rouge">!~*</code></td>
      <td>Case-insensitive POSIX regular expression mismatch</td>
    </tr>
  </tbody>
</table>

<h2 id="casting">Casting</h2>

<p>PostgreSQL can cast values with the <code class="highlighter-rouge">::</code> operator. Massive’s criteria object supports this exactly as in SQL. For example, to convert a UUID field to TEXT for pattern matching, you could create a criteria object as follows:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">criteria</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'my_uuid::text LIKE'</span><span class="p">:</span> <span class="s1">'12345%'</span>
<span class="p">};</span>
</code></pre>
</div>

<h2 id="json-traversal">JSON Traversal</h2>

<p>Massive supports searching in JSON and JSONB fields using the common traversal operators. You can quote fields yourself or leave it up to the parser.</p>

<p>JSON traversal operators and SQL operations may be combined.</p>

<p><code class="highlighter-rouge">field -&gt;&gt; key</code> generates a predicate in the <code class="highlighter-rouge">WHERE</code> clause testing the value at <code class="highlighter-rouge">field.key</code>.</p>

<p><code class="highlighter-rouge">field #&gt;&gt; {one, two, three}</code> generates a predicate in the <code class="highlighter-rouge">WHERE</code> clause testing the deeply-nested value at <code class="highlighter-rouge">field.one.two.three</code>.</p>


      </section>
    </div>
    <script src="/massive-js/assets/js/scale.fix.js"></script>


  
  </body>
</html>

