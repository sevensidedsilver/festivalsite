<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Massive.js by dmfay</title>

    <link rel="stylesheet" href="/massive-js/assets/css/style.css?v=8f3b5004dbc09941550749da6d7e90b279e958cc">
    <link rel="stylesheet" href="/assets/css/custom.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="/massive-js">Massive.js</a></h1>
        <p>Massive.js is a data mapper for Node.js that goes all in on PostgreSQL and fully embraces the power and flexibility of the SQL language and relational metaphors. Providing minimal abstractions for the interfaces and tools you already use, its goal is to do just enough to make working with your data as easy and intuitive as possible, then get out of your way.
</p>

        
          <p class="view"><a href="http://github.com/dmfay/massive-js">View the Project on GitHub <small></small></a></p>
        

        <h2>Contents</h2>
        <ul class="toc">
          <li><a href="/massive-js/connecting.html">Connecting</a></li>
          <li><a href="/massive-js/criteria.html">Criteria Objects</a></li>
          <li><a href="/massive-js/queries.html">Queries</a></li>
          <li><a href="/massive-js/persistence.html">Persistence</a></li>
          <li><a href="/massive-js/documents.html">Working with Documents</a></li>
          <li><a href="/massive-js/functions.html">Functions and Scripts</a></li>
          <li><a href="/massive-js/run.html">Raw SQL</a></li>
          <li><a href="/massive-js/api/index.html">API Docs</a></li>
        </ul>

        

        
        <p>This project is maintained by <a href="http://github.com/dmfay">dmfay</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>

        
      </header>
      <section>

      <h1 id="connecting">Connecting</h1>

<p>Require Massive and invoke the function with connection information. The resulting promise resolves into a connected database instance.</p>

<p>The connection process is fast but does take time. The instance is intended to be maintained and reused rather than regenerated.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">massive</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'massive'</span><span class="p">);</span>

<span class="nx">massive</span><span class="p">(</span><span class="nx">connectionInfo</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">instance</span> <span class="o">=&gt;</span> <span class="p">{...});</span>
</code></pre>
</div>

<p>You can connect Massive to your database with a <a href="https://github.com/vitaly-t/pg-promise/wiki/Connection-Syntax#configuration-object">pg-promise configuration object</a> or a connection string. Using the former is recommended since connection strings provide no mechanism for configuring the pool size and other options.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">connectionInfo</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">host</span><span class="p">:</span> <span class="s1">'localhost'</span><span class="p">,</span>
  <span class="na">port</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span>
  <span class="na">database</span><span class="p">:</span> <span class="s1">'appdb'</span><span class="p">,</span>
  <span class="na">user</span><span class="p">:</span> <span class="s1">'appuser'</span><span class="p">,</span>
  <span class="na">passsword</span><span class="p">:</span> <span class="s1">'apppwd'</span><span class="p">,</span>
  <span class="na">ssl</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">poolSize</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">};</span>
</code></pre>
</div>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">connectionInfo</span> <span class="o">=</span>
  <span class="s1">'postgres://appuser:apppwd@localhost:5432/appdb?ssl=false'</span><span class="p">;</span>
</code></pre>
</div>

<h2 id="introspection">Introspection</h2>

<p>On connection, Massive introspects your schema to find tables, views, and functions. Along with script files, these are attached to the instance object and form your database’s API.</p>

<p>Tables and views, including foreign tables and materialized views, are attached as objects with a set of standard access and persistence functions. See <a href="/queries">Queries</a> and <a href="/persistence">Persistence</a> for more details.</p>

<p>Database functions and scripts are attached as invocable functions. See <a href="/functions">Functions</a> for more.</p>

<h3 id="refreshing-the-api">Refreshing the API</h3>

<p>If you’re changing your database’s schema on the go by issuing <code class="highlighter-rouge">CREATE</code>, <code class="highlighter-rouge">ALTER</code>, and <code class="highlighter-rouge">DROP</code> statements at runtime, the connected Massive instance will eventually be out of date since it is generated at the time of connection. The <code class="highlighter-rouge">reload</code> function cleans out your database’s API and performs the introspection again, ensuring you can access dynamically instantiated objects.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">reload</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">refreshedInstance</span> <span class="o">=&gt;</span> <span class="p">{...});</span>
</code></pre>
</div>

<h3 id="schemas">Schemas</h3>

<p>Massive understands database schemas and treats any schema other than the default <code class="highlighter-rouge">public</code> as a namespace. Objects bound to the <code class="highlighter-rouge">public</code> schema are attached directly to the database object, while other schemas will be represented by a namespace attached to the database object, with their respective tables and views bound to the namespace.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// query a table on the public schema</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">find</span><span class="p">(...).</span><span class="nx">then</span><span class="p">(...);</span>

<span class="c1">// query a table on the auth schema</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">(...).</span><span class="nx">then</span><span class="p">(...);</span>
</code></pre>
</div>

<h2 id="loader-configuration-and-filtering">Loader Configuration and Filtering</h2>

<p>If you don’t want to load <em>every</em> table, view, or function your user can access, Massive lets you restrict which objects are loaded through a set of white- and blacklist options on initialization. Any, all, or none of the loader configuration fields may be specified, or the object may be omitted entirely as long as driver configuration is also omitted.</p>

<p>Blacklists and whitelists may use SQL <code class="highlighter-rouge">LIKE</code> (<code class="highlighter-rouge">_</code> and <code class="highlighter-rouge">%</code> placeholders) wildcarding. Consistent with PostgreSQL naming, they are case-sensitive.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">massive</span><span class="p">(</span><span class="nx">connectionInfo</span><span class="p">,</span> <span class="p">{</span>
  <span class="c1">// change the scripts directory</span>
  <span class="na">scripts</span><span class="p">:</span> <span class="s1">'./myscripts'</span><span class="p">,</span>

  <span class="c1">// ignore objects in any other schema</span>
  <span class="na">allowedSchemas</span><span class="p">:</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'auth'</span><span class="p">],</span>   

  <span class="c1">// only load tables and views matching the whitelist</span>
  <span class="na">whitelist</span><span class="p">:</span> <span class="p">[</span><span class="s1">'test%'</span><span class="p">,</span> <span class="s1">'users'</span><span class="p">],</span>

  <span class="c1">// never load these tables or views...</span>
  <span class="na">blacklist</span><span class="p">:</span> <span class="p">[</span><span class="s1">'device%'</span><span class="p">],</span>

  <span class="c1">// ...unless they appear here</span>
  <span class="na">exceptions</span><span class="p">:</span> <span class="p">[</span><span class="s1">'device_sessions'</span><span class="p">],</span>

  <span class="c1">// only load functions matching the whitelist</span>
  <span class="na">functionWhitelist</span><span class="p">:</span> <span class="p">[</span><span class="s1">'%user%'</span><span class="p">],</span>

  <span class="c1">// never load functions on the blacklist</span>
  <span class="na">functionBlacklist</span><span class="p">:</span> <span class="p">[</span><span class="s1">'authorizeUser'</span><span class="p">],</span>

  <span class="c1">// don't load database functions at all</span>
  <span class="na">excludeFunctions</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>

  <span class="c1">// streamline function return values: a function with a scalar</span>
  <span class="c1">// value will return just the scalar instead of an array, etc.</span>
  <span class="na">enhancedFunctions</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">instance</span> <span class="o">=&gt;</span> <span class="p">{...});</span>
</code></pre>
</div>

<h2 id="driver-configuration">Driver Configuration</h2>

<p>Direct configuration of the pg-promise driver is supported by passing <a href="https://github.com/vitaly-t/pg-promise#initialization-options">initialization options</a> as the third argument when connecting Massive.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">massive</span><span class="p">(</span><span class="nx">connectionInfo</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span>
  <span class="na">pgNative</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">capSQL</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">instance</span> <span class="o">=&gt;</span> <span class="p">{...});</span>
</code></pre>
</div>


      </section>
    </div>
    <script src="/massive-js/assets/js/scale.fix.js"></script>


  
  </body>
</html>

