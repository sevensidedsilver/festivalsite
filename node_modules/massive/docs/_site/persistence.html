<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Massive.js by dmfay</title>

    <link rel="stylesheet" href="/massive-js/assets/css/style.css?v=8f3b5004dbc09941550749da6d7e90b279e958cc">
    <link rel="stylesheet" href="/assets/css/custom.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="/massive-js">Massive.js</a></h1>
        <p>Massive.js is a data mapper for Node.js that goes all in on PostgreSQL and fully embraces the power and flexibility of the SQL language and relational metaphors. Providing minimal abstractions for the interfaces and tools you already use, its goal is to do just enough to make working with your data as easy and intuitive as possible, then get out of your way.
</p>

        
          <p class="view"><a href="http://github.com/dmfay/massive-js">View the Project on GitHub <small></small></a></p>
        

        <h2>Contents</h2>
        <ul class="toc">
          <li><a href="/massive-js/connecting.html">Connecting</a></li>
          <li><a href="/massive-js/criteria.html">Criteria Objects</a></li>
          <li><a href="/massive-js/queries.html">Queries</a></li>
          <li><a href="/massive-js/persistence.html">Persistence</a></li>
          <li><a href="/massive-js/documents.html">Working with Documents</a></li>
          <li><a href="/massive-js/functions.html">Functions and Scripts</a></li>
          <li><a href="/massive-js/run.html">Raw SQL</a></li>
          <li><a href="/massive-js/api/index.html">API Docs</a></li>
        </ul>

        

        
        <p>This project is maintained by <a href="http://github.com/dmfay">dmfay</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>

        
      </header>
      <section>

      <h1 id="persistence">Persistence</h1>

<p>Massive’s lack of entity modeling means it retrieves your data in the form of plain JavaScript objects and arrays, and <em>storing</em> your data is no different. The use of objects instead of models makes persistence an extremely flexible proposition: you can write what you want when you want and, unlike with object-relational models, ignore anything you don’t know. The persistence methods operate only on the columns you specify, and leave all others with the existing or default value, as appropriate.</p>

<h2 id="save">save</h2>

<p><code class="highlighter-rouge">save</code> performs an upsert. On initialization, Massive records your tables’ primary key information and uses this to determine whether the object passed to <code class="highlighter-rouge">save</code> represents a new or an existing row and invokes <code class="highlighter-rouge">insert</code> or <code class="highlighter-rouge">update</code> appropriately. The promise <code class="highlighter-rouge">save</code> returns will resolve to the created or modified data.</p>

<p><code class="highlighter-rouge">save</code> may not be used with foreign tables, since they do not have primary keys to test.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span>
  <span class="na">version</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'homepage'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">tests</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// an array containing the newly-inserted test</span>
<span class="p">});</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="na">priority</span><span class="p">:</span> <span class="s1">'high'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">tests</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// an array containing the updated test; note that the name</span>
  <span class="c1">// will not have changed!</span>
<span class="p">});</span>
</code></pre>
</div>

<h3 id="insert">insert</h3>

<p><code class="highlighter-rouge">insert</code> takes an object and returns a promise for an array containing the inserted data.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'homepage'</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">tests</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// an array containing the newly-inserted test</span>
<span class="p">});</span>
</code></pre>
</div>

<p>You can insert multiple rows at once – just pass an array:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">insert</span><span class="p">([{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'homepage'</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'about us'</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}]).</span><span class="nx">then</span><span class="p">(</span><span class="nx">tests</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// an array containing both newly-inserted tests</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="update">update</h2>

<p><code class="highlighter-rouge">update</code> has two variants. Passed an object with a value for the table’s primary key field, it updates all included fields of the object based on the primary key; or, passed a criteria object and a changes map, it applies all changes to all rows matching the criteria. Only the criteria-changes variant can be used with foreign tables.</p>

<p>Both <code class="highlighter-rouge">update</code> functions return promises for arrays containing the updated data.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="na">priority</span><span class="p">:</span> <span class="s1">'high'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">tests</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// an array containing the updated test</span>
<span class="p">});</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
  <span class="na">priority</span><span class="p">:</span> <span class="s1">'high'</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="na">priority</span><span class="p">:</span> <span class="s1">'moderate'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">tests</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// an array containing all tests which formerly had</span>
  <span class="c1">// priority 'high'. Since this issues a prepared</span>
  <span class="c1">// statement, note that the version field cannot</span>
  <span class="c1">// be incremented here!</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="destroy">destroy</h2>

<p><code class="highlighter-rouge">destroy</code> removes data matching a criteria object, and returns a promise for an array containing the deleted data.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">destroy</span><span class="p">({</span>
  <span class="na">priority</span><span class="p">:</span> <span class="s1">'high'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">tests</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// an array containing all removed tests</span>
<span class="p">});</span>
</code></pre>
</div>


      </section>
    </div>
    <script src="/massive-js/assets/js/scale.fix.js"></script>


  
  </body>
</html>

